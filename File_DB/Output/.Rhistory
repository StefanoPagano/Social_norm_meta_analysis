ggplot(data=master%>% subset.data.frame(Choice_Method!="OnlyNorms"), aes(x=Norm_Strength, y=Delta)) + geom_point() + geom_smooth(method = "lm")+ facet_wrap(~Macro_game_type, ncol=3) + stat_cor(method = "spearman")# + geom_text(aes(label=PaperID))
DG <- master %>% subset.data.frame(Game_type=="DG" & Choice_Method!= "OnlyNorms")
DG_UG <- master %>% subset.data.frame(Game_type=="DG"|Game_type=="UG")
UG <- master %>% subset.data.frame(Game_type=="UG"& Choice_Method!= "OnlyNorms")
hp4_mean <- master %>%
subset.data.frame(subset = Game_type %in% c("DG", "UG")&Choice_Method != "OnlyNorms") %>%
group_by(Game_type) %>%
summarise(Coop = mean(Avg_coop, na.rm = T),
Avg_Norm = mean(Avg_NE, na.rm = T),
Delta = mean(Delta, na.rm = T),
Strength = mean(Norm_Strength, na.rm = T),
n = n()) %>%
arrange(Game_type)
master_test <- master %>% subset.data.frame(select = c(Game_type, Avg_coop, Avg_NE, Delta, Norm_Strength, Macro_game_type, Sd_Avg_NE, Var_NE), subset = Game_type %in% c("DG", "UG"))
wilc_delta = wilcox.test(Delta ~ Macro_game_type, data=master_test)
wilc_strength = wilcox.test(Norm_Strength ~ Macro_game_type, data = master_test)
wilc_coop = wilcox.test(Avg_coop ~ Macro_game_type, data = master_test)
wilc_norm = wilcox.test(Avg_NE ~ Macro_game_type, data = master_test)
hp4plus_mean <- hp4_mean %>% add_row(Game_type = "Difference (Wilcoxon p-value)", Coop = wilc_coop$p.value, Avg_Norm = wilc_norm$p.value, Delta = wilc_delta$p.value, Strength = wilc_strength$p.value)
hp4plus_mean
opts <- options(knitr.kable.NA = "")
kbl(hp4plus_mean, digits = 4, booktabs = T, align = "lccccc", centering = F, caption = "Average and Mann-Whitney-Wilcoxon Test") %>%
kable_styling(position = "left", full_width = F) %>%
column_spec(1, bold = T) %>%
row_spec(3, bold = T, color = "white", background = "#6c757d")
cor.test(master$Norm_Strength, master$Delta, method= "spearman", exact = F)
ggplot(data=master%>% subset.data.frame(Choice_Method!="OnlyNorms"), aes(x=Norm_Strength, y=Delta)) + geom_point() + geom_smooth(method = "lm") + stat_cor(method = "spearman") #geom_text(aes(label=PaperID))
ggplot(data=master%>% subset.data.frame(Choice_Method!="OnlyNorms"), aes(x=Norm_Strength, y=Delta)) + geom_point() + geom_smooth(method = "lm")+ facet_wrap(~Macro_game_type, ncol=3) + stat_cor(method = "spearman")# + geom_text(aes(label=PaperID))
ggplot(data=master%>% subset.data.frame(Choice_Method!="OnlyNorms"), aes(x=Norm_Strength, y=Delta)) + geom_point() + geom_smooth(method = "lm") + stat_cor(method = "spearman") #geom_text(aes(label=PaperID))
ggplot(data=master%>% subset.data.frame(Choice_Method!="OnlyNorms"), aes(x=Norm_Strength, y=Delta)) + geom_point() + geom_smooth(method = "lm")+ facet_wrap(~Macro_game_type, ncol=3) + stat_cor(method = "spearman")# + geom_text(aes(label=PaperID))
cor.test(master$Norm_Strength, master$Delta, method= "spearman", exact = F)
ggplot(data=master%>% subset.data.frame(Choice_Method!="OnlyNorms"), aes(x=Norm_Strength, y=Delta)) + geom_point() + geom_smooth(method = "lm") + stat_cor(method = "spearman") #geom_text(aes(label=PaperID))
ggplot(data=master%>% subset.data.frame(Choice_Method!="OnlyNorms"), aes(x=Norm_Strength, y=Delta)) + geom_point() + geom_smooth(method = "lm")+ facet_wrap(~Macro_game_type, ncol=3) + stat_cor(method = "spearman")# + geom_text(aes(label=PaperID))
rm(list=ls())
library(ggplot2)
library(tidyverse)
library(mlogit)
library(sjmisc)
library(ggrepel)
library(readxl)
library(ggpubr)
library(survival)
library(sjPlot)
library(kableExtra)
library(car)
library(DT)
library(zoo)
setwd("../")
# read data
master <- read.csv("File_DB/Output/Treatment.csv") %>%
mutate(Macro_game_type = ifelse(Game_type %in% c("DG","Donation Game"), "DG and Donation Game", Game_type), SD_NE=sqrt(Var_NE)) %>%
subset.data.frame(subset = !(Standard_game %in% c("N")))
cor.test(master$Avg_NE, master$Avg_coop, method= "spearman", exact = F)
ggplot(data=master, aes(x=Avg_NE, y=Avg_coop)) + geom_point() + geom_smooth(method = "lm") + ggtitle("Fig. 1: H1 : Correlation Between Average Cooperation and Norm (NE)") + stat_cor(method = "spearman") + xlab("Cooperation Norm (as % of endowment)") + ylab("Cooperation (% of endowment)")
ggplot(data=master, aes(x=Avg_NE, y=Avg_coop)) + geom_point() + geom_smooth(method = "lm") + ggtitle("Fig. 2: H1 : Correlation Between Average Cooperation and Norm (NE)") + facet_wrap(~Macro_game_type, ncol=3) + stat_cor(method = "spearman")
# specificity = mean of max deviation
# consistency = sqrt(Var_NE)
master = master %>% mutate(Norm_Strength = 1/sqrt(Var_NE) + Sd_Avg_NE_min_max,
Delta = (Avg_NE-Avg_coop))
summary(master$Norm_Strength)
ggplot(data=master%>% subset.data.frame(Choice_Method!="OnlyNorms"), aes(x=Norm_Strength)) +
geom_histogram() + ggtitle("Histogram of Norm Strength") + xlab("Strength Norm") + facet_wrap(~Game_type)
cor.test(master$Norm_Strength, master$Delta, method= "spearman", exact = F)
ggplot(data=master%>% subset.data.frame(Choice_Method!="OnlyNorms"), aes(x=Norm_Strength, y=Delta)) + geom_point() + geom_smooth(method = "lm") + stat_cor(method = "spearman") #geom_text(aes(label=PaperID))
ggplot(data=master%>% subset.data.frame(Choice_Method!="OnlyNorms"), aes(x=Norm_Strength, y=Delta)) + geom_point() + geom_smooth(method = "lm")+ facet_wrap(~Macro_game_type, ncol=3) + stat_cor(method = "spearman")# + geom_text(aes(label=PaperID))
rm(list=ls())
library(ggplot2)
library(tidyverse)
library(mlogit)
library(sjmisc)
library(ggrepel)
library(readxl)
library(ggpubr)
library(survival)
library(sjPlot)
library(kableExtra)
library(car)
library(DT)
library(zoo)
setwd("../")
# read data
master <- read.csv("File_DB/Output/Treatment.csv") %>%
mutate(Macro_game_type = ifelse(Game_type %in% c("DG","Donation Game"), "DG and Donation Game", Game_type), SD_NE=sqrt(Var_NE)) %>%
subset.data.frame(subset = !(Standard_game %in% c("N")))
cor.test(master$Avg_NE, master$Avg_coop, method= "spearman", exact = F)
ggplot(data=master, aes(x=Avg_NE, y=Avg_coop)) + geom_point() + geom_smooth(method = "lm") + ggtitle("Fig. 1: H1 : Correlation Between Average Cooperation and Norm (NE)") + stat_cor(method = "spearman") + xlab("Cooperation Norm (as % of endowment)") + ylab("Cooperation (% of endowment)")
ggplot(data=master, aes(x=Avg_NE, y=Avg_coop)) + geom_point() + geom_smooth(method = "lm") + ggtitle("Fig. 2: H1 : Correlation Between Average Cooperation and Norm (NE)") + facet_wrap(~Macro_game_type, ncol=3) + stat_cor(method = "spearman")
# specificity = mean of max deviation
# consistency = sqrt(Var_NE)
master = master %>% mutate(Norm_Strength = 1/sqrt(Var_NE) + specificity,
Delta = (Avg_NE-Avg_coop))
summary(master$Norm_Strength)
ggplot(data=master%>% subset.data.frame(Choice_Method!="OnlyNorms"), aes(x=Norm_Strength)) +
geom_histogram() + ggtitle("Histogram of Norm Strength") + xlab("Strength Norm") + facet_wrap(~Game_type)
cor.test(master$Norm_Strength, master$Delta, method= "spearman", exact = F)
ggplot(data=master%>% subset.data.frame(Choice_Method!="OnlyNorms"), aes(x=Norm_Strength, y=Delta)) + geom_point() + geom_smooth(method = "lm") + stat_cor(method = "spearman") #geom_text(aes(label=PaperID))
ggplot(data=master%>% subset.data.frame(Choice_Method!="OnlyNorms"), aes(x=Norm_Strength, y=Delta)) + geom_point() + geom_smooth(method = "lm")+ facet_wrap(~Macro_game_type, ncol=3) + stat_cor(method = "spearman")# + geom_text(aes(label=PaperID))
# set wd
setwd("G:/.shortcut-targets-by-id/1IoJDOQWCFiL1qTzSja6byrAlCelNSTsT/Meta-analysis beliefs/Dati paper/2020And089")
csv_path_output <- "C:/Users/stefa/Documents/CNR/GitHub/Social_norm_meta_analysis/Paper_csv/"
# choice file
dg=read_excel("2020And089_data.xlsx", sheet = "public decisions data")
# only columns needed
dg <- dg %>% subset.data.frame(select = c(1,4,6,19:20))
# rename columns
colnames(dg) <- c("Treatment", "sent", "Pdg_coop", "Age", "Experiment")
# add id variable as a progressive numbers
dg <- dg %>% mutate(id = c(1:374)) %>%
mutate(Pdg_cooperate = recode(Pdg_coop, `1` = 0, `2` = 1 ))
# norms file
norms=read_excel("DecisionRevealProsocial_NormElicitationData.xlsx", sheet = "datanew")
# rename columns
colnames(norms) <- c("Condition", "KW00", "KW10", "KW20", "KW30", "KW40", "KW50", "AppropPGG_COOPERATE", "AppropPGG_DEFECT","Approp_Switch","Approp_DontSwitch","Approp_Suffocate","AppropDontSuffocate","Common_DonateChoice","Common_DonateAverage","Common_PGG","Common_UtilSwitch","Common_UtilSuffocateBaby","Age","Gender")
# recoding
norms <- norms %>% mutate(id = c(1:195)) %>%
mutate(sent = recode(Common_DonateChoice, `1` = 0, `2` = 10, `3` = 20, `4` = 30, `5` = 40, `6` = 50)) %>%
mutate(KW00_M = recode(KW00, `-1` = -1/3, `-2` = -1, `1` = 1/3, `2` = 1),
KW10_M = recode(KW10, `-1` = -1/3, `-2` = -1, `1` = 1/3, `2` = 1),
KW20_M = recode(KW20, `-1` = -1/3, `-2` = -1, `1` = 1/3, `2` = 1),
KW30_M = recode(KW30, `-1` = -1/3, `-2` = -1, `1` = 1/3, `2` = 1),
KW40_M = recode(KW40, `-1` = -1/3, `-2` = -1, `1` = 1/3, `2` = 1),
KW50_M = recode(KW50, `-1` = -1/3, `-2` = -1, `1` = 1/3, `2` = 1),
KWPDG_Coop = recode(AppropPGG_COOPERATE,`-1` = -1/3, `-2` = -1, `1` = 1/3, `2` = 1),
KWPDG_Def = recode(AppropPGG_DEFECT, `-1` = -1/3, `-2` = -1, `1` = 1/3, `2` = 1),
EE_PDG = recode(Common_PGG, `1` = 1, `2` = 0))
library(readxl)
library(tidyverse)
# set wd
setwd("G:/.shortcut-targets-by-id/1IoJDOQWCFiL1qTzSja6byrAlCelNSTsT/Meta-analysis beliefs/Dati paper/2020And089")
csv_path_output <- "C:/Users/stefa/Documents/CNR/GitHub/Social_norm_meta_analysis/Paper_csv/"
# choice file
dg=read_excel("2020And089_data.xlsx", sheet = "public decisions data")
# only columns needed
dg <- dg %>% subset.data.frame(select = c(1,4,6,19:20))
# rename columns
colnames(dg) <- c("Treatment", "sent", "Pdg_coop", "Age", "Experiment")
# add id variable as a progressive numbers
dg <- dg %>% mutate(id = c(1:374)) %>%
mutate(Pdg_cooperate = recode(Pdg_coop, `1` = 0, `2` = 1 ))
# norms file
norms=read_excel("DecisionRevealProsocial_NormElicitationData.xlsx", sheet = "datanew")
# rename columns
colnames(norms) <- c("Condition", "KW00", "KW10", "KW20", "KW30", "KW40", "KW50", "AppropPGG_COOPERATE", "AppropPGG_DEFECT","Approp_Switch","Approp_DontSwitch","Approp_Suffocate","AppropDontSuffocate","Common_DonateChoice","Common_DonateAverage","Common_PGG","Common_UtilSwitch","Common_UtilSuffocateBaby","Age","Gender")
# recoding
norms <- norms %>% mutate(id = c(1:195)) %>%
mutate(sent = recode(Common_DonateChoice, `1` = 0, `2` = 10, `3` = 20, `4` = 30, `5` = 40, `6` = 50)) %>%
mutate(KW00_M = recode(KW00, `-1` = -1/3, `-2` = -1, `1` = 1/3, `2` = 1),
KW10_M = recode(KW10, `-1` = -1/3, `-2` = -1, `1` = 1/3, `2` = 1),
KW20_M = recode(KW20, `-1` = -1/3, `-2` = -1, `1` = 1/3, `2` = 1),
KW30_M = recode(KW30, `-1` = -1/3, `-2` = -1, `1` = 1/3, `2` = 1),
KW40_M = recode(KW40, `-1` = -1/3, `-2` = -1, `1` = 1/3, `2` = 1),
KW50_M = recode(KW50, `-1` = -1/3, `-2` = -1, `1` = 1/3, `2` = 1),
KWPDG_Coop = recode(AppropPGG_COOPERATE,`-1` = -1/3, `-2` = -1, `1` = 1/3, `2` = 1),
KWPDG_Def = recode(AppropPGG_DEFECT, `-1` = -1/3, `-2` = -1, `1` = 1/3, `2` = 1),
EE_PDG = recode(Common_PGG, `1` = 1, `2` = 0))
# meta-information dataset
meta_dataset <- read_xlsx(path = "G:/.shortcut-targets-by-id/1IoJDOQWCFiL1qTzSja6byrAlCelNSTsT/Meta-analysis beliefs/Social Norms meta.xlsx", sheet = "ALL") %>% subset.data.frame(subset = PaperID == "2020And089", select = c(n_Paper, PaperID, TreatmentCode, TreatmentName_paper, Year, Outlet, Published, FirstTask, between_vs_within, Game_type, Standard_game, Group_size, One_Shot_Repeated, Choice_Method, Matching, Rounds, Punishment, Rewards, Monetary_Incentivized_experiment, Environment, Method_elicitation, Separate_sample_beliefs, Belief_repeated, Before_after_main_decisions, KW_Normative, KW_Personal, Bicchieri_Empirical, Bicchieri_Normative, Bicchieri_Personal_Beliefs, Bicchieri_between, Incentives_beliefs, StatusTreatment_Roma)) %>% mutate(TreatmentCode = as.numeric(TreatmentCode))
coldg = c("id","Treatment","sent")
# 1. Choice dataframe ----
dg_dta_coop <- dg %>% subset.data.frame(select = coldg, Treatment == 1) %>%
mutate(endowment = 50, cooperation = sent/endowment) %>%
summarise(Avg_coop = mean(cooperation, na.rm =T),
Var_coop = var(cooperation, na.rm = T)) %>%
mutate(PaperID = "2020And089", TreatmentCode = 1)
label_col = as.character(seq(0,50,10))
norms_columns <- c(1,15,16,21,23:31)
norms %>% subset.data.frame(select = norms_columns) %>%
subset.data.frame(subset = Condition == 0) %>% summarise(n_sub_N = n())
View(norms)
n_sub_N = norms %>% subset.data.frame(select = norms_columns) %>%
subset.data.frame(subset = Condition == 0) %>% summarise(n_sub_N = n())
positive_appropriateness <- dg_appropriateness_sum %>% subset.data.frame(subset = Kw_m > 0) %>%
mutate(delta_max = max(Kw_m) - Kw_m)
## compute variance norm
dg_norms_var <- norms[, norms_columns] %>%
subset.data.frame(subset = Condition == 0) %>%
summarise_at(vars(KW00_M:KW50_M), var, na.rm=T) %>%
t.data.frame() %>%
cbind.data.frame(donation=label_col)
## compute norm
dg_appropriateness_sum <- norms %>% subset.data.frame(select = norms_columns) %>%
subset.data.frame(subset = Condition == 0) %>%
summarise_at(vars(KW00_M:KW50_M), sum, na.rm=T) %>%
t.data.frame() %>%
cbind.data.frame(donation=label_col) %>%
mutate(n_sub_N, Kw_m = ./n_sub_N)
positive_appropriateness <- dg_appropriateness_sum %>% subset.data.frame(subset = Kw_m > 0) %>%
mutate(delta_max = max(Kw_m) - Kw_m)
## compute variance norm
dg_norms_var <- norms[, norms_columns] %>%
subset.data.frame(subset = Condition == 0) %>%
summarise_at(vars(KW00_M:KW50_M), var, na.rm=T) %>%
t.data.frame() %>%
cbind.data.frame(donation=label_col)
dg_EE <- norms [, norms_columns] %>%
subset.data.frame(subset = Condition == 0) %>%
summarise(Avg_EE = mean(Common_DonateAverage, na.rm =T))
dg_final_norms <- merge.data.frame(dg_appropriateness_sum, dg_norms_var, by = "donation") %>%
subset.data.frame(subset = ..x == max(..x)) %>%
mutate(PaperID = "2020And089",
TreatmentCode = 1,
Avg_NE = as.integer(donation)/50,
Var_NE = ..y,
Sd_Avg_NE = sd(dg_appropriateness_sum$Kw_m),
Avg_EE = as.numeric(dg_EE/50),
Sd_Avg_NE_min_max = max(positive_appropriateness$Kw_m) - min(positive_appropriateness$Kw_m),
specificity = sum(positive_appropriateness$delta_max)/((length(positive_appropriateness$delta_max)-1)),
max_sigma = sd(c(rep(-1, ifelse(n_sub_N%%2==0, n_sub_N/2, (n_sub_N-1)/2)), rep(1, ifelse(n_sub_N%%2==0, n_sub_N/2, (n_sub_N+1)/2))))) %>%
subset.data.frame(select = -c(..x, ..y, donation))
View(dg_final_norms)
View(norms %>% filter(Condition==1))
rm(list = ls())
# set wd
setwd("G:/.shortcut-targets-by-id/1IoJDOQWCFiL1qTzSja6byrAlCelNSTsT/Meta-analysis beliefs/Dati paper/2019Cha026")
csv_path_output <- "C:/Users/stefa/Documents/CNR/GitHub/Social_norm_meta_analysis/Paper_csv/"
dg=read_excel("data.xls", sheet = "Sheet1",
col_types = c("numeric", "numeric", "numeric",
"numeric", "numeric", "numeric",
"numeric", "numeric", "numeric",
"numeric", "numeric", "numeric",
"numeric", "numeric", "numeric"))
## the next file contains all data except the conditional PG elicitations, which we did later
norms <- dg %>%
subset.data.frame(select = c(subject, elicit_norms, frame_tax, endowment, action, order,  norm),
subset = elicit_norms == 1) %>%
subset.data.frame(subset = endowment == 10) %>%
subset.data.frame(subset = order == 1)
# meta-information dataset
meta_dataset <- read_xlsx(path = "G:/.shortcut-targets-by-id/1IoJDOQWCFiL1qTzSja6byrAlCelNSTsT/Meta-analysis beliefs/Social Norms meta.xlsx", sheet = "ALL") %>% subset.data.frame(subset = PaperID == "2019Cha026", select = c(n_Paper, PaperID, TreatmentCode, TreatmentName_paper, Year, Outlet, Published, FirstTask, between_vs_within, Game_type, Standard_game, Group_size, One_Shot_Repeated, Choice_Method, Matching, Rounds, Punishment, Rewards, Monetary_Incentivized_experiment, Environment, Method_elicitation, Separate_sample_beliefs, Belief_repeated, Before_after_main_decisions, KW_Normative, KW_Personal, Bicchieri_Empirical, Bicchieri_Normative, Bicchieri_Personal_Beliefs, Bicchieri_between, Incentives_beliefs, StatusTreatment_Roma)) %>% mutate(TreatmentCode = as.numeric(TreatmentCode))
## subject : subject in the session
## elicit_norms : experiment subject was in. 0 = Choice experiment, 1 = Norm elicitation experiment
## frame_tax: treatment subject was in. 0 = Neutrally-framed, 1 = Tax-framed
## endowment : we take only rounds where the dictator had 10 tokens
## keep: for subjects in the choice experiment, the number of tokens they kept for themselves.
coldg = c("subject","elicit_norms", "order", "frame_tax","endowment", "keep")
# 1. Choice dataframe ----
dgn_dta_coop <- dg %>% subset.data.frame(select = coldg, subset = frame_tax == 0) %>%
subset.data.frame(subset = elicit_norms == 0) %>%
subset.data.frame(subset = endowment == 10) %>%
subset.data.frame(subset = order == 1) %>%
mutate(cooperation = (endowment - keep)/endowment) %>%
summarise(Avg_coop = mean(cooperation, na.rm =T),
Var_coop = var(cooperation, na.rm = T)) %>%
mutate(PaperID = "2019Cha026", TreatmentCode = 1)
label_col = as.character(seq(0,10,1))
norms %>%
subset.data.frame(subset = frame_tax == 0 & order == 1 & endowment == 10 & elicit_norms == 1) %>% summarise(n_sub_N = n()/11)
View(norms)
nrow(norms %>% filter(elicit_norms == 1 & endowment == 10 & order == 1))
nrow(norms %>% filter(elicit_norms == 1 & endowment == 10 & order == 1 & frame_tax == 0))
View(norms %>% filter(elicit_norms == 1 & endowment == 10 & order == 1 & frame_tax == 0))
norms %>% filter(elicit_norms == 1 & endowment == 10 & order == 1 & frame_tax == 0) %>% summarise(n_distinct(subject))
n_sub_N = norms %>%
subset.data.frame(subset = frame_tax == 0 & order == 1 & endowment == 10 & elicit_norms == 1) %>% summarise(n_sub_N = n()/11)
## compute norm
dgn_appropriateness_sum <- norms %>%
subset.data.frame(subset = frame_tax == 0) %>%
group_by(action) %>%
summarise(coop = sum(norm))%>%
mutate(n_sub_N, Kw_m = coop/n_sub_N)
dgn_appropriateness_sum
norms %>% filter(elicit_norms == 1 & endowment == 10 & order == 1 & frame_tax == 0 & action == 5) %>% summarise(sum(norm))
positive_appropriateness <- dgn_appropriateness_sum %>% subset.data.frame(subset = Kw_m > 0) %>%
mutate(delta_max = max(Kw_m) - Kw_m)
positive_appropriateness
## compute variance norm
dgn_norms_var <- norms %>%
subset.data.frame(subset = frame_tax == 0) %>%
group_by(action) %>%
summarise(var_coop = var(norm))
dgn_norms_var
## compute variance norm
dgn_norms_var <- norms %>%
subset.data.frame(subset = frame_tax == 0) %>%
group_by(action) %>%
summarise(var_norm = var(norm))
dgn_final_norms <- merge.data.frame(dgn_appropriateness_sum, dgn_norms_var, by = "action") %>%
subset.data.frame(subset = coop == max(coop)) %>%
mutate(PaperID = "2019Cha026",
TreatmentCode = 1,
Avg_NE = action/10,
Var_NE = var_norm,
Sd_Avg_NE = sd(dgn_appropriateness_sum$Kw_m),
Sd_Avg_NE_min_max = max(positive_appropriateness$Kw_m) - min(positive_appropriateness$Kw_m),
specificity = sum(positive_appropriateness$delta_max)/((length(positive_appropriateness$delta_max)-1)),
max_sigma = sd(c(rep(0.2, ifelse(n_sub_N%%2==0, n_sub_N/2, (n_sub_N-1)/2)), rep(1, ifelse(n_sub_N%%2==0, n_sub_N/2, (n_sub_N+1)/2))))) %>%
subset.data.frame(select = -c(coop, var_norm, action))
View(dgn_final_norms)
positive_appropriateness <- dgt_appropriateness_sum %>% subset.data.frame(subset = Kw_m > 0) %>%
mutate(delta_max = max(Kw_m) - Kw_m)
## compute variance norm
dgt_norms_var <- norms %>%
subset.data.frame(subset = frame_tax == 1) %>%
group_by(action) %>%
summarise(var_norm = var(norm))
dgt_final_norms <- merge.data.frame(dgt_appropriateness_sum, dgt_norms_var, by = "action") %>%
subset.data.frame(subset = coop == max(coop)) %>%
mutate(PaperID = "2019Cha026",
TreatmentCode = 2,
Avg_NE = action/10,
Var_NE = var_norm,
Sd_Avg_NE = sd(dgt_appropriateness_sum$Kw_m),
Sd_Avg_NE_min_max = max(positive_appropriateness$Kw_m) - min(positive_appropriateness$Kw_m),
specificity = sum(positive_appropriateness$delta_max)/((length(positive_appropriateness$delta_max)-1)),
max_sigma = sd(c(rep(-1, ifelse(n_sub_N%%2==0, n_sub_N/2, (n_sub_N-1)/2)), rep(1, ifelse(n_sub_N%%2==0, n_sub_N/2, (n_sub_N+1)/2))))) %>%
subset.data.frame(select = -c(coop, var_norm, action))
# set wd
setwd("G:/.shortcut-targets-by-id/1IoJDOQWCFiL1qTzSja6byrAlCelNSTsT/Meta-analysis beliefs/Dati paper/2019Cha026")
csv_path_output <- "C:/Users/stefa/Documents/CNR/GitHub/Social_norm_meta_analysis/Paper_csv/"
dg=read_excel("data.xls", sheet = "Sheet1",
col_types = c("numeric", "numeric", "numeric",
"numeric", "numeric", "numeric",
"numeric", "numeric", "numeric",
"numeric", "numeric", "numeric",
"numeric", "numeric", "numeric"))
## the next file contains all data except the conditional PG elicitations, which we did later
norms <- dg %>%
subset.data.frame(select = c(subject, elicit_norms, frame_tax, endowment, action, order,  norm),
subset = elicit_norms == 1) %>%
subset.data.frame(subset = endowment == 10) %>%
subset.data.frame(subset = order == 1)
# meta-information dataset
meta_dataset <- read_xlsx(path = "G:/.shortcut-targets-by-id/1IoJDOQWCFiL1qTzSja6byrAlCelNSTsT/Meta-analysis beliefs/Social Norms meta.xlsx", sheet = "ALL") %>% subset.data.frame(subset = PaperID == "2019Cha026", select = c(n_Paper, PaperID, TreatmentCode, TreatmentName_paper, Year, Outlet, Published, FirstTask, between_vs_within, Game_type, Standard_game, Group_size, One_Shot_Repeated, Choice_Method, Matching, Rounds, Punishment, Rewards, Monetary_Incentivized_experiment, Environment, Method_elicitation, Separate_sample_beliefs, Belief_repeated, Before_after_main_decisions, KW_Normative, KW_Personal, Bicchieri_Empirical, Bicchieri_Normative, Bicchieri_Personal_Beliefs, Bicchieri_between, Incentives_beliefs, StatusTreatment_Roma)) %>% mutate(TreatmentCode = as.numeric(TreatmentCode))
## subject : subject in the session
## elicit_norms : experiment subject was in. 0 = Choice experiment, 1 = Norm elicitation experiment
## frame_tax: treatment subject was in. 0 = Neutrally-framed, 1 = Tax-framed
## endowment : we take only rounds where the dictator had 10 tokens
## keep: for subjects in the choice experiment, the number of tokens they kept for themselves.
coldg = c("subject","elicit_norms", "order", "frame_tax","endowment", "keep")
# 1. Choice dataframe ----
dgn_dta_coop <- dg %>% subset.data.frame(select = coldg, subset = frame_tax == 0) %>%
subset.data.frame(subset = elicit_norms == 0) %>%
subset.data.frame(subset = endowment == 10) %>%
subset.data.frame(subset = order == 1) %>%
mutate(cooperation = (endowment - keep)/endowment) %>%
summarise(Avg_coop = mean(cooperation, na.rm =T),
Var_coop = var(cooperation, na.rm = T)) %>%
mutate(PaperID = "2019Cha026", TreatmentCode = 1)
label_col = as.character(seq(0,10,1))
n_sub_N = norms %>%
subset.data.frame(subset = frame_tax == 0 & order == 1 & endowment == 10 & elicit_norms == 1) %>% summarise(n_sub_N = n()/11)
## compute norm
dgn_appropriateness_sum <- norms %>%
subset.data.frame(subset = frame_tax == 0) %>%
group_by(action) %>%
summarise(coop = sum(norm))%>%
mutate(n_sub_N, Kw_m = coop/n_sub_N)
positive_appropriateness <- dgn_appropriateness_sum %>% subset.data.frame(subset = Kw_m > 0) %>%
mutate(delta_max = max(Kw_m) - Kw_m)
## compute variance norm
dgn_norms_var <- norms %>%
subset.data.frame(subset = frame_tax == 0) %>%
group_by(action) %>%
summarise(var_norm = var(norm))
dgn_final_norms <- merge.data.frame(dgn_appropriateness_sum, dgn_norms_var, by = "action") %>%
subset.data.frame(subset = coop == max(coop)) %>%
mutate(PaperID = "2019Cha026",
TreatmentCode = 1,
Avg_NE = action/10,
Var_NE = var_norm,
Sd_Avg_NE = sd(dgn_appropriateness_sum$Kw_m),
Sd_Avg_NE_min_max = max(positive_appropriateness$Kw_m) - min(positive_appropriateness$Kw_m),
specificity = sum(positive_appropriateness$delta_max)/((length(positive_appropriateness$delta_max)-1)),
max_sigma = sd(c(rep(-1, ifelse(n_sub_N%%2==0, n_sub_N/2, (n_sub_N-1)/2)), rep(1, ifelse(n_sub_N%%2==0, n_sub_N/2, (n_sub_N+1)/2))))) %>%
subset.data.frame(select = -c(coop, var_norm, action))
# 3. combine dataset ----
finaldf <- meta_dataset %>%
merge.data.frame(dgn_dta_coop, by = c("PaperID","TreatmentCode")) %>%
merge.data.frame(dgn_final_norms, all.x=T, by = c("PaperID","TreatmentCode")) %>%
subset.data.frame(select = -c(n_sub_N, Kw_m))
finaldf
library(tidyverse)
library(readxl)
rm(list = ls())
# Run paper script
setwd("C:/Users/stefa/Documents/CNR/GitHub/Social_norm_meta_analysis/Paper_script/")
source("2016Kim003.R")
setwd("C:/Users/stefa/Documents/CNR/GitHub/Social_norm_meta_analysis/Paper_script/")
source("2019Cha026.R")
setwd("C:/Users/stefa/Documents/CNR/GitHub/Social_norm_meta_analysis/Paper_script/")
source("2017Tho028.R")
setwd("C:/Users/stefa/Documents/CNR/GitHub/Social_norm_meta_analysis/Paper_script/")
source("2015Ves034.R")
#problema paper... forse la task iniziale influenza molto la norma... non Ã¨ 50% ma 83%
setwd("C:/Users/stefa/Documents/CNR/GitHub/Social_norm_meta_analysis/Paper_script/")
source("2017Del037.R")
# i trattamenti sono diversi in base alla nazione... mancano i dati sulle norme
setwd("C:/Users/stefa/Documents/CNR/GitHub/Social_norm_meta_analysis/Paper_script/")
source("2018Kim038.R")
# media norma 100%
setwd("C:/Users/stefa/Documents/CNR/GitHub/Social_norm_meta_analysis/Paper_script/")
source("2017Ves049.R")
setwd("C:/Users/stefa/Documents/CNR/GitHub/Social_norm_meta_analysis/Paper_script/")
source("2019Tjo060.R")
setwd("C:/Users/stefa/Documents/CNR/GitHub/Social_norm_meta_analysis/Paper_script/")
source("2018Her061.R")
setwd("C:/Users/stefa/Documents/CNR/GitHub/Social_norm_meta_analysis/Paper_script/")
source("2019Dro082.R")
setwd("C:/Users/stefa/Documents/CNR/GitHub/Social_norm_meta_analysis/Paper_script/")
source("2020And089.R")
setwd("C:/Users/stefa/Documents/CNR/GitHub/Social_norm_meta_analysis/Paper_script/")
source("2020Bas115.R")
# mancano i dati di kw, da richiedere
setwd("C:/Users/stefa/Documents/CNR/GitHub/Social_norm_meta_analysis/Paper_script/")
source("2017Sen116.R")
setwd("C:/Users/stefa/Documents/CNR/GitHub/Social_norm_meta_analysis/Paper_script/")
source("2021Kon127.R")
rm(list = ls())
# Create the master file -> merge all csv file
setwd("C:/Users/stefa/Documents/CNR/GitHub/Social_norm_meta_analysis/Paper_csv/")
Paper_003=read.csv("2016Kim003_finaldf.csv", sep=",")
master <- Paper_003
Paper_026=read.csv("2019Cha026_finaldf.csv", sep=",")
master <- Paper_026 %>%
rbind.data.frame(master)
Paper_028=read.csv("2017Tho028_finaldf.csv", sep=",")
master <- Paper_028 %>%
rbind.data.frame(master)
Paper_034=read.csv("2015Ves034_finaldf.csv", sep=",")
master <- Paper_034 %>%
rbind.data.frame(master)
Paper_037=read.csv("2017Del037_finaldf.csv", sep=",")
master <- Paper_037 %>%
rbind.data.frame(master)
Paper_038=read.csv("2018Kim038_finaldf.csv", sep=",")
master <- Paper_038 %>%
rbind.data.frame(master)
Paper_049=read.csv("2017Ves049_finaldf.csv", sep=",")
master <- Paper_049 %>%
rbind.data.frame(master)
Paper_060=read.csv("2019Tjo060_finaldf.csv", sep=",")
master <- Paper_060 %>%
rbind.data.frame(master)
Paper_061=read.csv("2018Her061_finaldf.csv", sep=",")
master <- Paper_061 %>%
rbind.data.frame(master)
Paper_082=read.csv("2019Dro082_finaldf.csv", sep=",")
master <- Paper_082 %>%
rbind.data.frame(master)
Paper_089=read.csv("2020And089_finaldf.csv", sep=",")
master <- Paper_089 %>%
rbind.data.frame(master)
Paper_115=read.csv("2020Bas115_finaldf.csv", sep=",")
master <- Paper_115 %>%
rbind.data.frame(master)
Paper_116=read.csv("2017Sen116_finaldf.csv", sep=",")
master <- Paper_116 %>%
rbind.data.frame(master)
Paper_127=read.csv("2021Kon127_finaldf.csv", sep=",")
master <- Paper_127 %>%
rbind.data.frame(master)
# save master file as csv
setwd("C:/Users/stefa/Documents/CNR/GitHub/Social_norm_meta_analysis/File_DB/Output/")
write.csv(master, file = "Treatment.csv", row.names = F)
master %>% mutate(sd_ne = sqrt(Var_NE)) %>% filter(max_sigma<sd_ne)
master %>% mutate(sd_ne = sqrt(Var_NE)) %>% filter(max_sigma>sd_ne) %>% select(PaperID, TreatmentCode)
master %>% mutate(sd_ne = sqrt(Var_NE)) %>% filter(max_sigma<sd_ne) %>% select(PaperID, TreatmentCode)
rm(list = -ls(master))
rm(list = !ls(master))
rm(list = !(ls(master)))
rm(list = !(ls()=="master"))
rm(list = ls()["master"])
rm(list = ls()[!(ls() %in% c("master"))])
master
colnames(master)
rm(list=ls())
library(ggplot2)
library(tidyverse)
library(mlogit)
library(sjmisc)
library(ggrepel)
library(readxl)
library(ggpubr)
library(survival)
library(sjPlot)
library(kableExtra)
library(car)
library(DT)
library(zoo)
setwd("../")
# read data
master <- read.csv("File_DB/Output/Treatment.csv") %>%
mutate(Macro_game_type = ifelse(Game_type %in% c("DG","Donation Game"), "DG and Donation Game", Game_type), SD_NE=sqrt(Var_NE)) %>%
subset.data.frame(subset = !(Standard_game %in% c("N")))
cor.test(master$Avg_NE, master$Avg_coop, method= "spearman", exact = F)
ggplot(data=master, aes(x=Avg_NE, y=Avg_coop)) + geom_point() + geom_smooth(method = "lm") + ggtitle("Fig. 1: H1 : Correlation Between Average Cooperation and Norm (NE)") + stat_cor(method = "spearman") + xlab("Cooperation Norm (as % of endowment)") + ylab("Cooperation (% of endowment)")
ggplot(data=master, aes(x=Avg_NE, y=Avg_coop)) + geom_point() + geom_smooth(method = "lm") + ggtitle("Fig. 2: H1 : Correlation Between Average Cooperation and Norm (NE)") + facet_wrap(~Macro_game_type, ncol=3) + stat_cor(method = "spearman")
# specificity = mean of max deviation
# consistency = sqrt(Var_NE)
master = master %>% mutate(consistency=sqrt(Var_NE)/max_sigma,
Norm_Strength = sqrt(Var_NE)/max_sigma + specificity,
Delta = (Avg_NE-Avg_coop))
summary(master$Norm_Strength)
summary(master$specificity)
summary(master$consistency)
```{r echo=FALSE, message=FALSE, warning=FALSE, cache=FALSE, comment=""}
ggplot(data=master%>% subset.data.frame(Choice_Method!="OnlyNorms"), aes(x=Norm_Strength)) +
geom_histogram(bins = 3) + ggtitle("Histogram of Norm Strength") + xlab("Strength Norm") + facet_wrap(~Game_type)
ggplot(data=master%>% subset.data.frame(Choice_Method!="OnlyNorms"), aes(x=Norm_Strength)) +
geom_histogram(bins = 4) + ggtitle("Histogram of Norm Strength") + xlab("Strength Norm") + facet_wrap(~Game_type)
ggplot(data=master%>% subset.data.frame(Choice_Method!="OnlyNorms"), aes(x=Norm_Strength)) +
geom_histogram(bins = 5) + ggtitle("Histogram of Norm Strength") + xlab("Strength Norm") + facet_wrap(~Game_type)
ggplot(data=master%>% subset.data.frame(Choice_Method!="OnlyNorms"), aes(x=Norm_Strength)) +
geom_histogram(bins = 6) + ggtitle("Histogram of Norm Strength") + xlab("Strength Norm") + facet_wrap(~Game_type)
ggplot(data=master%>% subset.data.frame(Choice_Method!="OnlyNorms"), aes(x=Norm_Strength)) +
geom_histogram(bins = 7) + ggtitle("Histogram of Norm Strength") + xlab("Strength Norm") + facet_wrap(~Game_type)
ggplot(data=master%>% subset.data.frame(Choice_Method!="OnlyNorms"), aes(x=Norm_Strength)) +
geom_histogram(bins = 8) + ggtitle("Histogram of Norm Strength") + xlab("Strength Norm") + facet_wrap(~Game_type)
ggplot(data=master%>% subset.data.frame(Choice_Method!="OnlyNorms"), aes(x=Norm_Strength)) +
geom_histogram(bins = 8, col=I("black")) + ggtitle("Histogram of Norm Strength") + xlab("Strength Norm") + facet_wrap(~Game_type)
ggplot(data=master%>% subset.data.frame(Choice_Method!="OnlyNorms"), aes(x=Norm_Strength)) +
geom_histogram(bins = 7, col=I("black")) + ggtitle("Histogram of Norm Strength") + xlab("Strength Norm") + facet_wrap(~Game_type)
