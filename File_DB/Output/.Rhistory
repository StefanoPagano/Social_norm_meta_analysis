library(ggplot2)
library(tidyverse)
library(mclogit)
library(sjmisc)
library(ggrepel)
library(readxl)
library(ggpubr)
library(survival)
library(sjPlot)
setwd("../")
# read data
master <- read.csv("File_DB/Output/Treatment.csv") %>% mutate(Delta_Avg = Avg_NE - Avg_coop,
Macro_game_type = ifelse(Game_type %in% c("DG","Donation Game"), "DG and Donation Game", Game_type)) %>% subset.data.frame(subset = PaperID !="2017Del037")
beliefs <- read.csv("../File_DB/Output/Subjects_beliefs.csv", sep = ",")
choices <- read.csv("../File_DB/Output/Subjects_choices.csv", sep = ",")
beliefs_w <- beliefs %>% subset.data.frame(subset = Design=="Within")
choices_w <- choices %>% subset.data.frame(subset = Design=="Within")
individual_db_w <- merge.data.frame(choices_w, beliefs_w)
Bas115 = individual_db_w %>% subset.data.frame(paper_id=="2020Bas115") %>% mutate(payoff=endowment-scenarios)
clogit.bas <- clogit(A~ payoff + KW_Normative + strata(subject_id), data = Bas115)
summary(clogit.bas)
beliefs <- read.csv("../File_DB/Output/Subjects_beliefs.csv", sep = ",")
choices <- read.csv("../File_DB/Output/Subjects_choices.csv", sep = ",")
beliefs_w <- beliefs %>% subset.data.frame(subset = Design=="Within")
choices_w <- choices %>% subset.data.frame(subset = Design=="Within")
individual_db_w <- merge.data.frame(choices_w, beliefs_w)
Bas115 = individual_db_w %>% subset.data.frame(paper_id=="2020Bas115") %>% mutate(payoff=endowment-scenarios)
clogit.bas <- clogit(A~ payoff + KW_Normative + strata(subject_id), data = Bas115)
summary(clogit.bas)
beliefs_b <- beliefs %>% subset.data.frame(subset = Design=="Between") %>% group_by(paper_id, scenarios) %>% summarise(KW_Normative = mean(KW_Normative))
choices_b <- choices %>% subset.data.frame(subset = Design=="Between")%>% mutate(payoff=endowment-scenarios)
individual_db_b <- merge.data.frame(choices_b, beliefs_b)
between <- clogit(A~ payoff + KW_Normative + strata(subject_id, treatment_id, paper_id), data = individual_db_b)
betas=between$coefficients
sigma=sqrt(between$var) # diagonal is variance; others are covariance
plot_model(model = between )
between <- clogit(A~ payoff + KW_Normative + strata(subject_id, treatment_id, paper_id), data = individual_db_b)
betas=between$coefficients
summary(between)
sigma=sqrt(between$var) # diagonal is variance; others are covariance
plot_model(model = between )
Kim003 = individual_db_b %>% subset.data.frame(paper_id=="2016Kim003") %>% mutate(payoff=endowment-scenarios)
clogit.kim <- clogit(A~ payoff + KW_Normative + strata(subject_id, treatment_id, paper_id), data = Kim003)
summary(clogit.kim)
betas=clogit.kim$coefficients
sigma=sqrt(clogit.kim$var) # diagonal is variance; others are covariance
plot_model(model = clogit.kim, title = "2016Kim003: Conditional Logit Model")
Her061 = individual_db_b %>% subset.data.frame(paper_id=="2018Her061") %>% mutate(payoff=endowment-scenarios)
clogit.her <- clogit(A~ payoff + KW_Normative + strata(subject_id, treatment_id, paper_id), data = Her061)
summary(clogit.her)
betas=clogit.her$coefficients
sigma=sqrt(clogit.her$var) # diagonal is variance; others are covariance
plot_model(model = clogit.her, title = "2018Her061: Conditional Logit Model")
Cha026 = individual_db_b %>% subset.data.frame(paper_id=="2019Cha026") %>% mutate(payoff=endowment-scenarios)
clogit.cha <- clogit(A~ payoff + KW_Normative + strata(subject_id, treatment_id, paper_id), data = Cha026)
summary(clogit.cha)
betas=clogit.cha$coefficients
sigma=sqrt(clogit.cha$var) # diagonal is variance; others are covariance
plot_model(model = clogit.cha, title = "2019Cha026: Conditional Logit Model")
plot_models(between, Bas115)
Cha026 = individual_db_b %>% subset.data.frame(paper_id=="2019Cha026") %>% mutate(payoff=endowment-scenarios)
clogit.cha <- clogit(A~ payoff + KW_Normative + strata(subject_id, treatment_id, paper_id), data = Cha026)
summary(clogit.cha)
betas=clogit.cha$coefficients
sigma=sqrt(clogit.cha$var) # diagonal is variance; others are covariance
plot_model(model = clogit.cha, title = "2019Cha026: Conditional Logit Model")
plot_models(c(between, Bas115)
Cha026 = individual_db_b %>% subset.data.frame(paper_id=="2019Cha026") %>% mutate(payoff=endowment-scenarios)
clogit.cha <- clogit(A~ payoff + KW_Normative + strata(subject_id, treatment_id, paper_id), data = Cha026)
summary(clogit.cha)
betas=clogit.cha$coefficients
sigma=sqrt(clogit.cha$var) # diagonal is variance; others are covariance
plot_model(model = clogit.cha, title = "2019Cha026: Conditional Logit Model")
plot_models(c(between, Bas115))
plot_models(Kim003, Cha026)
Cha026 = individual_db_b %>% subset.data.frame(paper_id=="2019Cha026") %>% mutate(payoff=endowment-scenarios)
clogit.cha <- clogit(A~ payoff + KW_Normative + strata(subject_id, treatment_id, paper_id), data = Cha026)
summary(clogit.cha)
betas=clogit.cha$coefficients
sigma=sqrt(clogit.cha$var) # diagonal is variance; others are covariance
plot_model(model = clogit.cha, title = "2019Cha026: Conditional Logit Model")
plot_models(Kim003, Cha026)
library(tidyverse)
library(readxl)
meta_dataset <- read_xlsx(path = "G:/.shortcut-targets-by-id/1IoJDOQWCFiL1qTzSja6byrAlCelNSTsT/Meta-analysis beliefs/Social Norms meta.xlsx", sheet = "ALL")
game_type_in_target = c("DG", "PGG", "PDG", "Donation Game", "Ultimatum Game", "TG", "ToG", "CPR", "GEG", "DG Tax", "BG", "Lying DG", "Third-Party Lying DG", "Tax Game", "Investment Game")
meta_filtered <- meta_dataset %>% subset.data.frame(subset = Game_type %in% game_type_in_target)
View(meta_filtered)
meta_filtered <- meta_dataset %>% subset.data.frame(subset = Game_type %in% game_type_in_target & Monetary_Incentivized_experiment == Y)
meta_filtered <- meta_dataset %>% subset.data.frame(subset = Game_type %in% game_type_in_target & Monetary_Incentivized_experiment == "Y")
meta_filtered <- meta_dataset %>% subset.data.frame(subset = Game_type %in% game_type_in_target & Monetary_Incentivized_experiment == "Y" & Method_elicitation != "N")
N_treatments_in_target = n(meta_filtered)
N_treatments_in_target <- meta_filtered %>% group_by(Game_type) %>% summarise(ntit = n ())
View(N_treatments_in_target)
N_treatments_in_target <- meta_filtered %>% group_by(Game_type) %>% summarise(treatment_in_target_per_game = n ()) %>% arrange(treatment_in_target_per_game)
N_treatments_in_target <- meta_filtered %>% group_by(Game_type) %>% summarise(treatment_in_target_per_game = n ()) %>% arrange(-treatment_in_target_per_game)
table_treatments_in_target_per_game <- meta_filtered %>% group_by(Game_type) %>% summarise(treatments_in_target_per_game = n ()) %>% arrange(-treatments_in_target_per_game)
Sum_of_treatments_in_target = sum(table_treatments_in_target_per_game$treatments_in_target_per_game)
sum(table_treatments_in_target_per_game$treatments_in_target_per_game)
table_treatments_in_target_per_game <- meta_filtered %>% group_by(Game_type, between_vs_within) %>% summarise(treatments_in_target_per_game = n ()) %>% arrange(-treatments_in_target_per_game)
View(table_treatments_in_target_per_game)
table_treatments_in_target_per_game <- meta_filtered %>%
group_by(Game_type) %>%
summarise(treatments_in_target_per_game = n (),
between_subjects_beliefs = sum(Separate_sample_beliefs == "Y"),
KW = sum(Method_elicitation == "KW"),
Bicchieri = sum(Method_elicitation == "Bicchieri"),
KW_and_Bicchieri = sum(Method_elicitation == "Both"),
Only_Norms = sum(Choice_Method == "OnlyNorms"),
Available_data = sum(StatusTreatment_Roma == "6-Complete")) %>%
arrange(-treatments_in_target_per_game)
View(table_treatments_in_target_per_game)
game_type_in_target = c("DG", "PGG", "PDG", "Donation Game", "UG", "TG", "ToG", "CPR", "GEG", "DG Tax", "BG", "Lying DG", "Third-Party Lying DG", "Tax Game", "Investment Game")
## number of treatments in target
meta_filtered <- meta_dataset %>% subset.data.frame(subset = Game_type %in% game_type_in_target & Monetary_Incentivized_experiment == "Y" & Method_elicitation != "N")
table_treatments_in_target_per_game <- meta_filtered %>%
group_by(Game_type) %>%
summarise(treatments_in_target_per_game = n (),
between_subjects_beliefs = sum(Separate_sample_beliefs == "Y"),
KW = sum(Method_elicitation == "KW"),
Bicchieri = sum(Method_elicitation == "Bicchieri"),
KW_and_Bicchieri = sum(Method_elicitation == "Both"),
Only_Norms = sum(Choice_Method == "OnlyNorms"),
Available_data = sum(StatusTreatment_Roma == "6-Complete")) %>%
arrange(-treatments_in_target_per_game)
Sum_of_treatments_in_target = sum(table_treatments_in_target_per_game$treatments_in_target_per_game)
table_treatments_in_target_per_game <- meta_filtered %>%
group_by(Game_type) %>%
summarise(treatments_in_target_per_game = n (),
between_subjects_beliefs = sum(Separate_sample_beliefs == "Y", na.rm = T),
KW = sum(Method_elicitation == "KW", na.rm = T),
Bicchieri = sum(Method_elicitation == "Bicchieri", na.rm = T),
KW_and_Bicchieri = sum(Method_elicitation == "Both", na.rm = T),
Only_Norms = sum(Choice_Method == "OnlyNorms", na.rm = T),
Available_data = sum(StatusTreatment_Roma == "6-Complete", na.rm = T)) %>%
arrange(-treatments_in_target_per_game)
Sum_of_treatments_in_target = sum(table_treatments_in_target_per_game$treatments_in_target_per_game)
View(table_treatments_in_target_per_game)
library(kableExtra)
kable(table_treatments_in_target_per_game)
tinytex::install_tinytex()
knitr::opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE, cache=FALSE, comment="", include=FALSE)
library(tidyverse)
library(readxl)
#### SOCIAL NORMS META-ANALYSIS INFORMATION ####
meta_dataset <- read_xlsx(path = "G:/.shortcut-targets-by-id/1IoJDOQWCFiL1qTzSja6byrAlCelNSTsT/Meta-analysis beliefs/Social Norms meta.xlsx", sheet = "ALL")
#### SOCIAL NORMS META-ANALYSIS INFORMATION ####
meta_dataset <- read_xlsx(path = "G:/.shortcut-targets-by-id/1IoJDOQWCFiL1qTzSja6byrAlCelNSTsT/Meta-analysis beliefs/Social Norms meta.xlsx", sheet = "ALL")
game_type_in_target = c("DG", "PGG", "PDG", "Donation Game", "UG", "TG", "ToG", "CPR", "GEG", "DG Tax", "BG", "Lying DG", "Third-Party Lying DG", "Tax Game", "Investment Game")
## number of treatments in target
meta_filtered <- meta_dataset %>% subset.data.frame(subset = Game_type %in% game_type_in_target & Monetary_Incentivized_experiment == "Y" & Method_elicitation != "N")
table_treatments_in_target_per_game <- meta_filtered %>%
group_by(Game_type) %>%
summarise(treatments_in_target_per_game = n (),
between_subjects_beliefs = sum(Separate_sample_beliefs == "Y", na.rm = T),
KW = sum(Method_elicitation == "KW", na.rm = T),
Bicchieri = sum(Method_elicitation == "Bicchieri", na.rm = T),
KW_and_Bicchieri = sum(Method_elicitation == "Both", na.rm = T),
Only_Norms = sum(Choice_Method == "OnlyNorms", na.rm = T),
Available_data = sum(StatusTreatment_Roma == "6-Complete", na.rm = T)) %>%
arrange(-treatments_in_target_per_game)
Sum_of_treatments_in_target = sum(table_treatments_in_target_per_game$treatments_in_target_per_game)
Sum_of_treatments_in_target
table_treatments_in_target_per_game
opts <- options(knitr.kable.NA = "")
kbl(table_treatments_in_target_per_game, digits = 0, booktabs = T, align = "lccccccc", centering = F, caption = "Summary of Major Variables per Game Type") %>%
kable_styling(position = "left", full_width = F) %>%
column_spec(1, bold = T)
library(kableExtra)
opts <- options(knitr.kable.NA = "")
kbl(table_treatments_in_target_per_game, digits = 0, booktabs = T, align = "lccccccc", centering = F, caption = "Summary of Major Variables per Game Type") %>%
kable_styling(position = "left", full_width = F) %>%
column_spec(1, bold = T)
tinytex::reinstall_tinytex()
tinytex::parse_install()
tinytex::parse_install("Social_Norms_Information.log")
setwd("~/CNR/GitHub/Social_norm_meta_analysis/File_DB/Documentation")
tinytex::parse_install("Social_Norms_Information.log")
rmarkdown::pandoc_version()
#knitr::opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE, cache=FALSE, comment="", include=FALSE)
library(tidyverse)
library(readxl)
library(kableExtra)
knitr::include_graphics("Attachments/StatusTreatment.png")
install.packages("bookdown")
csv_path_output <- "C:/Users/stefa/Documents/CNR/GitHub/Social_norm_meta_analysis/File_DB/"
df_merge_game_type = read_xlsx(path = "G:/.shortcut-targets-by-id/1IoJDOQWCFiL1qTzSja6byrAlCelNSTsT/Meta-analysis beliefs/Social Norms meta.xlsx", sheet = "ALL") %>%
subset.data.frame(select = c(treatment_id, Game_type, Separate_sample_beliefs))
# set wd
setwd("G:/.shortcut-targets-by-id/1IoJDOQWCFiL1qTzSja6byrAlCelNSTsT/Meta-analysis beliefs/Dati paper/2018Her061")
# set wd
setwd("G:/.shortcut-targets-by-id/1IoJDOQWCFiL1qTzSja6byrAlCelNSTsT/Meta-analysis beliefs/Dati paper/2016Kim003")
# choice file
Kim003_dg=read.csv("DG_Data.csv", sep="\t")
Kim003_ug=read.table("UG_Data.txt", header = T)
# norms file
Kim003_db_norms=read.csv("Norm_Elicitation_Data.csv", sep = ",")
Kim003_db_norms <- Kim003_db_norms %>%
mutate(ANSW01 = recode(answers.1., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW02 = recode(answers.2., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW03 = recode(answers.3., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW04 = recode(answers.4., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW05 = recode(answers.5., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW06 = recode(answers.6., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW07 = recode(answers.7., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW08 = recode(answers.8., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW09 = recode(answers.9., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW12 = recode(answers.12., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW13 = recode(answers.13., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW14 = recode(answers.14., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW15 = recode(answers.15., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW16 = recode(answers.16., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW17 = recode(answers.17., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW18 = recode(answers.18., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW19 = recode(answers.19., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW20 = recode(answers.20., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW21 = recode(answers.21., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW22 = recode(answers.22., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW23 = recode(answers.23., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW24 = recode(answers.24., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW25 = recode(answers.25., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW26 = recode(answers.26., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW27 = recode(answers.27., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW28 = recode(answers.28., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW29 = recode(answers.29., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW30 = recode(answers.30., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW31 = recode(answers.31., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW34 = recode(answers.34., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW35 = recode(answers.35., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW36 = recode(answers.36., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW37 = recode(answers.37., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW38 = recode(answers.38., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW39 = recode(answers.39., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW40 = recode(answers.40., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW41 = recode(answers.41., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW42 = recode(answers.42., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1))
# DG
## choices
coldg = c("subj_id", "role", "sent", "gender", "age")
Kim003_sub_1 <- Kim003_dg %>%
subset.data.frame(select = coldg, subset = role == 1) %>%
mutate(endowment = 16) %>%
mutate(coop = sent/endowment) %>%
mutate(agex= 2016-age) %>%
mutate(subject_id = paste("2016Kim003", "7", subj_id, sep = "_")) %>%
mutate(treatment_id = paste("2016Kim003", "7", sep = "_"), paper_id = "2016Kim003")
colnames(Kim003_sub_1) <- c("subj_id", "role", "choice", "gender", "year_sub", "endowment", "cooperation", "age", "subject_id", "treatment_id", "paper_id")
Kim003_sub_1 <- Kim003_sub_1 %>%
subset.data.frame(select = -c(subj_id, role, year_sub)) %>%
relocate(subject_id, treatment_id, paper_id, choice, endowment, cooperation, gender, age)
Choice_Kim003_dg_DB <- Kim003_sub_1
## norms
Kim003_db_norms_dg <- Kim003_db_norms %>% subset.data.frame(select = dg_columns <- c(1, 3, 4, 135:143), subset = ANSW01 != 0) %>%
mutate(subject_id = paste("2016Kim003", "7","norms", session, Subject, sep = "_")) %>%
mutate(treatment_id = paste("2016Kim003", "7", sep = "_"), paper_id = "2016Kim003")
Kim003_beliefs_dg <- Kim003_db_norms_dg %>%
pivot_longer(!c(X140626_1150, session, Subject, subject_id, paper_id, treatment_id), names_to = "scenarios", values_to = "KW_Normative") %>%
mutate(scenarios = as.numeric(recode(scenarios, `ANSW01` = 0, `ANSW02` = 2, `ANSW03` = 4, `ANSW04` = 6, `ANSW05` = 8, `ANSW06` = 10, `ANSW07` = 12, `ANSW08` = 14, `ANSW09` = 16))) %>%
subset.data.frame(select = -c(X140626_1150, session, Subject)) %>%
merge.data.frame(df_merge_game_type, by = c("treatment_id")) %>%
mutate(KW_Personal = NA,
Bicchieri_Empirical = NA,
Bicchieri_Normative = NA,
Bicchieri_Personal = NA,
gender = NA,
age = NA,
Design = ifelse(Separate_sample_beliefs == "Y", "Between", "Within")) %>%
subset.data.frame(select = -c(Separate_sample_beliefs))
# set wd
setwd("G:/.shortcut-targets-by-id/1IoJDOQWCFiL1qTzSja6byrAlCelNSTsT/Meta-analysis beliefs/Dati paper/2016Kim003")
csv_path_output <- "C:/Users/stefa/Documents/CNR/GitHub/Social_norm_meta_analysis/Paper_csv/"
pgg=read.csv("PG_Data_bysubj.txt", sep="\t")
tgs=read.table("TG_Data_byperiod.txt", header = T)
ug=read.table("UG_Data.txt", header = T)
dg=read.csv("DG_Data.csv", sep="\t")
## the next file contains all data except the conditional PG elicitations, which we did later
norms1=read.csv("Norm_Elicitation_Data.csv", sep = ",")
norms1 <- norms1 %>% mutate(ANSW01 = recode(answers.1., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW02 = recode(answers.2., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW03 = recode(answers.3., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW04 = recode(answers.4., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW05 = recode(answers.5., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW06 = recode(answers.6., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW07 = recode(answers.7., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW08 = recode(answers.8., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW09 = recode(answers.9., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW12 = recode(answers.12., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW13 = recode(answers.13., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW14 = recode(answers.14., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW15 = recode(answers.15., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW16 = recode(answers.16., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW17 = recode(answers.17., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW18 = recode(answers.18., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW19 = recode(answers.19., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW20 = recode(answers.20., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW21 = recode(answers.21., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW22 = recode(answers.22., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW23 = recode(answers.23., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW24 = recode(answers.24., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW25 = recode(answers.25., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW26 = recode(answers.26., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW27 = recode(answers.27., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW28 = recode(answers.28., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW29 = recode(answers.29., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW30 = recode(answers.30., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW31 = recode(answers.31., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW34 = recode(answers.34., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW35 = recode(answers.35., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW36 = recode(answers.36., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW37 = recode(answers.37., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW38 = recode(answers.38., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW39 = recode(answers.39., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW40 = recode(answers.40., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW41 = recode(answers.41., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1),
ANSW42 = recode(answers.42., `1` = -1, `2` = -1/3, `3` = 1/3, `4` = 1))
# meta-information dataset
meta_dataset <- read_xlsx(path = "G:/.shortcut-targets-by-id/1IoJDOQWCFiL1qTzSja6byrAlCelNSTsT/Meta-analysis beliefs/Social Norms meta.xlsx", sheet = "ALL") %>% subset.data.frame(subset = PaperID == "2016Kim003", select = c(n_Paper, PaperID, TreatmentCode, TreatmentName_paper, Year, Outlet, Published, FirstTask, between_vs_within, Game_type, Standard_game, Group_size, One_Shot_Repeated, Choice_Method, Matching, Rounds, Punishment, Rewards, Monetary_Incentivized_experiment, Environment, Method_elicitation, Separate_sample_beliefs, Belief_repeated, Before_after_main_decisions, KW_Normative, KW_Personal, Bicchieri_Empirical, Bicchieri_Normative, Bicchieri_Personal_Beliefs, Bicchieri_between, Incentives_beliefs, StatusTreatment_Roma)) %>% mutate(TreatmentCode = as.numeric(TreatmentCode))
# cleaning DG
## exp_id : date and time of experiment
## exp_num : unique number of the experiment
## subj_id : exp_num * 100 + subj
## subj : subject in the session
## gr_id : unique group id in the dataset
## role : 1 proposer; 0 responder
## sent : amount sent; -1 if not applicable
coldg = c("exp_id","exp_num","subj_id","subj", "role", "sent")
# 1. Choice dataframe ----
dg_dta_coop <- dg %>% subset.data.frame(select = coldg, subset = role == 1) %>%
mutate(endowment = 16, cooperation = sent/endowment) %>%
summarise(Avg_coop = mean(cooperation, na.rm =T),
Var_coop = var(cooperation, na.rm = T)) %>%
mutate(PaperID = "2016Kim003", TreatmentCode = 7)
label_col = as.character(seq(0,16,2))
dg_columns <- c(1, 3, 4, 135:143)
n_sub_N = norms1 %>% summarise(n_sub_N = n())
## compute norm
dg_appropriateness_sum <- norms1 %>% subset.data.frame(select = dg_columns) %>%
summarise_at(vars(ANSW01:ANSW09), sum, na.rm=T) %>%
t.data.frame() %>%
cbind.data.frame(donation=label_col) %>%
mutate(n_sub_N, Kw_m = ./n_sub_N)
## compute variance norm
dg_norms_var <- norms1[, dg_columns] %>%
summarise_at(vars(ANSW01:ANSW09), var, na.rm=T) %>%
t.data.frame() %>%
cbind.data.frame(donation=label_col)
dg_final_norms <- merge.data.frame(dg_appropriateness_sum, dg_norms_var, by = "donation") %>%
subset.data.frame(subset = ..x == max(..x)) %>%
mutate(PaperID = "2016Kim003",
TreatmentCode = 7,
Avg_NE = as.integer(donation)/16,
Var_NE = ..y,
Sd_Avg_NE = sd(dg_appropriateness_sum$Kw_m)) %>%
subset.data.frame(select = -c(..x, ..y, donation))
View(dg_appropriateness_sum)
prova <- dg_appropriateness_sum %>% subset.data.frame(subset = Kw_m > 0)
View(prova)
prova_min = min(prova$Kw_m)
prova_max = max(prova$Kw_m)
specif = prova_max - prova_min
## compute norm
dg_appropriateness_sum <- norms1 %>% subset.data.frame(select = dg_columns) %>%
summarise_at(vars(ANSW01:ANSW09), sum, na.rm=T) %>%
t.data.frame() %>%
cbind.data.frame(donation=label_col) %>%
mutate(n_sub_N, Kw_m = ./n_sub_N)
positive_appropriateness <- dg_appropriateness_sum %>% subset.data.frame(subset = Kw_m > 0)
## compute variance norm
dg_norms_var <- norms1[, dg_columns] %>%
summarise_at(vars(ANSW01:ANSW09), var, na.rm=T) %>%
t.data.frame() %>%
cbind.data.frame(donation=label_col)
dg_final_norms <- merge.data.frame(dg_appropriateness_sum, dg_norms_var, by = "donation") %>%
subset.data.frame(subset = ..x == max(..x)) %>%
mutate(PaperID = "2016Kim003",
TreatmentCode = 7,
Avg_NE = as.integer(donation)/16,
Var_NE = ..y,
Sd_Avg_NE = sd(dg_appropriateness_sum$Kw_m),
Sd_Avg_NE2 = max(positive_appropriateness$Kw_m) - min(positive_appropriateness$Kw_m)) %>%
subset.data.frame(select = -c(..x, ..y, donation))
View(dg_final_norms)
dg_final_norms <- merge.data.frame(dg_appropriateness_sum, dg_norms_var, by = "donation") %>%
subset.data.frame(subset = ..x == max(..x)) %>%
mutate(PaperID = "2016Kim003",
TreatmentCode = 7,
Avg_NE = as.integer(donation)/16,
Var_NE = ..y,
Sd_Avg_NE = sd(dg_appropriateness_sum$Kw_m),
Sd_Avg_NE_min_max = max(positive_appropriateness$Kw_m) - min(positive_appropriateness$Kw_m)) %>%
subset.data.frame(select = -c(..x, ..y, donation))
1/specif
?sd
positive_appropriateness <- dg_appropriateness_sum %>% subset.data.frame(subset = Kw_m > 0) %>%
summarise(delta_max = max(kw_m) - Kw_m)
positive_appropriateness <- dg_appropriateness_sum %>% subset.data.frame(subset = Kw_m > 0) %>%
summarise(delta_max = max(Kw_m) - Kw_m)
View(positive_appropriateness)
positive_appropriateness <- dg_appropriateness_sum %>% subset.data.frame(subset = Kw_m > 0) %>%
mutate(delta_max = max(Kw_m) - Kw_m)
## compute variance norm
dg_norms_var <- norms1[, dg_columns] %>%
summarise_at(vars(ANSW01:ANSW09), var, na.rm=T) %>%
t.data.frame() %>%
cbind.data.frame(donation=label_col)
dg_final_norms <- merge.data.frame(dg_appropriateness_sum, dg_norms_var, by = "donation") %>%
subset.data.frame(subset = ..x == max(..x)) %>%
mutate(PaperID = "2016Kim003",
TreatmentCode = 7,
Avg_NE = as.integer(donation)/16,
Var_NE = ..y,
Sd_Avg_NE = sd(dg_appropriateness_sum$Kw_m),
Sd_Avg_NE_min_max = max(positive_appropriateness$Kw_m) - min(positive_appropriateness$Kw_m),
Sum_delta_max = sum(delta_max)) %>%
subset.data.frame(select = -c(..x, ..y, donation))
dg_final_norms <- merge.data.frame(dg_appropriateness_sum, dg_norms_var, by = "donation") %>%
subset.data.frame(subset = ..x == max(..x)) %>%
mutate(PaperID = "2016Kim003",
TreatmentCode = 7,
Avg_NE = as.integer(donation)/16,
Var_NE = ..y,
Sd_Avg_NE = sd(dg_appropriateness_sum$Kw_m),
Sd_Avg_NE_min_max = max(positive_appropriateness$Kw_m) - min(positive_appropriateness$Kw_m),
Sum_delta_max = sum(positive_appropriateness$delta_max)) %>%
subset.data.frame(select = -c(..x, ..y, donation))
View(dg_final_norms)
positive_appropriateness[,1]=100
rm(list = ls())
library(tidyverse)
library(readxl)
rm(list = ls())
# Run paper script
setwd("C:/Users/stefa/Documents/CNR/GitHub/Social_norm_meta_analysis/Paper_script/")
source("2016Kim003.R")
setwd("C:/Users/stefa/Documents/CNR/GitHub/Social_norm_meta_analysis/Paper_script/")
source("2019Cha026.R")
setwd("C:/Users/stefa/Documents/CNR/GitHub/Social_norm_meta_analysis/Paper_script/")
source("2017Tho028.R")
setwd("C:/Users/stefa/Documents/CNR/GitHub/Social_norm_meta_analysis/Paper_script/")
source("2015Ves034.R")
#problema paper... forse la task iniziale influenza molto la norma... non è 50% ma 83%
setwd("C:/Users/stefa/Documents/CNR/GitHub/Social_norm_meta_analysis/Paper_script/")
source("2017Del037.R")
# i trattamenti sono diversi in base alla nazione... mancano i dati sulle norme
setwd("C:/Users/stefa/Documents/CNR/GitHub/Social_norm_meta_analysis/Paper_script/")
source("2018Kim038.R")
# media norma 100%
setwd("C:/Users/stefa/Documents/CNR/GitHub/Social_norm_meta_analysis/Paper_script/")
source("2017Ves049.R")
setwd("C:/Users/stefa/Documents/CNR/GitHub/Social_norm_meta_analysis/Paper_script/")
source("2019Tjo060.R")
setwd("C:/Users/stefa/Documents/CNR/GitHub/Social_norm_meta_analysis/Paper_script/")
source("2018Her061.R")
setwd("C:/Users/stefa/Documents/CNR/GitHub/Social_norm_meta_analysis/Paper_script/")
source("2019Dro082.R")
setwd("C:/Users/stefa/Documents/CNR/GitHub/Social_norm_meta_analysis/Paper_script/")
source("2020And089.R")
setwd("C:/Users/stefa/Documents/CNR/GitHub/Social_norm_meta_analysis/Paper_script/")
source("2020Bas115.R")
# mancano i dati di kw, da richiedere
setwd("C:/Users/stefa/Documents/CNR/GitHub/Social_norm_meta_analysis/Paper_script/")
source("2017Sen116.R")
setwd("C:/Users/stefa/Documents/CNR/GitHub/Social_norm_meta_analysis/Paper_script/")
source("2021Kon127.R")
rm(list = ls())
# Create the master file -> merge all csv file
setwd("C:/Users/stefa/Documents/CNR/GitHub/Social_norm_meta_analysis/Paper_csv/")
Paper_003=read.csv("2016Kim003_finaldf.csv", sep=",")
master <- Paper_003
Paper_026=read.csv("2019Cha026_finaldf.csv", sep=",")
master <- Paper_026 %>%
rbind.data.frame(master)
Paper_028=read.csv("2017Tho028_finaldf.csv", sep=",")
master <- Paper_028 %>%
rbind.data.frame(master)
Paper_034=read.csv("2015Ves034_finaldf.csv", sep=",")
master <- Paper_034 %>%
rbind.data.frame(master)
Paper_037=read.csv("2017Del037_finaldf.csv", sep=",")
master <- Paper_037 %>%
rbind.data.frame(master)
Paper_038=read.csv("2018Kim038_finaldf.csv", sep=",")
master <- Paper_038 %>%
rbind.data.frame(master)
Paper_049=read.csv("2017Ves049_finaldf.csv", sep=",")
master <- Paper_049 %>%
rbind.data.frame(master)
Paper_060=read.csv("2019Tjo060_finaldf.csv", sep=",")
master <- Paper_060 %>%
rbind.data.frame(master)
Paper_061=read.csv("2018Her061_finaldf.csv", sep=",")
master <- Paper_061 %>%
rbind.data.frame(master)
Paper_082=read.csv("2019Dro082_finaldf.csv", sep=",")
master <- Paper_082 %>%
rbind.data.frame(master)
Paper_089=read.csv("2020And089_finaldf.csv", sep=",")
master <- Paper_089 %>%
rbind.data.frame(master)
Paper_115=read.csv("2020Bas115_finaldf.csv", sep=",")
master <- Paper_115 %>%
rbind.data.frame(master)
Paper_116=read.csv("2017Sen116_finaldf.csv", sep=",")
master <- Paper_116 %>%
rbind.data.frame(master)
Paper_127=read.csv("2021Kon127_finaldf.csv", sep=",")
master <- Paper_127 %>%
rbind.data.frame(master)
# save master file as csv
setwd("C:/Users/stefa/Documents/CNR/GitHub/Social_norm_meta_analysis/File_DB/Output/")
write.csv(master, file = "Treatment.csv", row.names = F)
View(master)
