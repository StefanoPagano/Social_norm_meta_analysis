library(tidyverse)
library(readxl)
library(writexl)
rm(list = ls())
#### Insert excel file path ####
Social_Norms_meta <- read_excel("G:/.shortcut-targets-by-id/1IoJDOQWCFiL1qTzSja6byrAlCelNSTsT/Meta-analysis beliefs/Social Norms meta.xlsx", sheet = "ALL")
csv_path_output <- "C:/Users/stefa/Documents/CNR/GitHub/Social_norm_meta_analysis/Other/Report_202107/"
#### List of Games ####
ls_game <- c("DG", "DG Tax", "UG", "PGG", "TG", "BG", "GEG", "PDG", "Donation Game", "Investment game", "ToG", "Tax Game")
#### Treatments stats ####
df_treat <- Social_Norms_meta %>%
subset.data.frame(subset = Target == "Y") %>%
subset.data.frame(subset = Game_type %in% ls_game) %>%
subset.data.frame(subset =
Environment %in% c("Classroom",
"Lab",
"Online",
"Lab-in-the-field",
"virtual Lab")) %>%
group_by(Game_type) %>%
summarise(
Treatments = n(),
Between_subjects_beliefs = sum(Separate_sample_beliefs == "Y", na.rm = T),
KW = sum(Method_elicitation == "KW", na.rm = T),
Bicchieri = sum(Method_elicitation == "Bicchieri", na.rm = T),
KW_Bicchieri = sum(Method_elicitation == "Both", na.rm = T),
Monetary_Punishment = sum(Punishment == "Monetary", na.rm = T),
Choice_Method_Direct = sum(Choice_Method == "Direct", na.rm = T),
Choice_Method_Strategy = sum(Choice_Method == "Strategy", na.rm = T),
OnlyNorms = sum(Choice_Method == "OnlyNorms", na.rm = T),
Choice_Method_Both = sum(Choice_Method == "Both", na.rm = T),
Available_Data = sum(StatusTreatment_Roma == "6-Complete", na.rm = T)
) %>%
arrange(-Treatments)
write.csv(df_treat, file = paste(csv_path_output, paste("Treatments.csv", sep = ""), sep = ""), row.names = F)
#### Dataset stats ####
df_data <- Social_Norms_meta %>%
subset.data.frame(subset = TreatmentCode %in% c("1","1a","1aa")) %>%
group_by(PaperID, StatusTreatment_Roma) %>%
summarise(
N_Paper = n(),
) %>%
group_by(StatusTreatment_Roma) %>%
summarise(N_Paper = n())
write.csv(df_treat, file = paste(csv_path_output, paste("Treatments.csv", sep = ""), sep = ""), row.names = F)
df_tot <- df_data %>% summarise(sum(N_Paper))
View(df_data)
View(df_tot)
df_data <- Social_Norms_meta %>%
subset.data.frame(subset = TreatmentCode %in% c("1","1a","1aa")) %>%
group_by(PaperID, StatusTreatment_Roma)
View(df_data)
subset.data.frame(subset = TreatmentCode %in% c("1","1a","1aa")) %>%
group_by(PaperID, StatusTreatment_Roma) %>%
summarise(
N_Paper = n(),
)
df_data <- Social_Norms_meta %>%
subset.data.frame(subset = TreatmentCode %in% c("1","1a","1aa")) %>%
group_by(PaperID, StatusTreatment_Roma) %>%
summarise(
N_Paper = n(),
)
View(df_data)
library(tidyverse)
library(readxl)
library(writexl)
rm(list = ls())
Social_Norms_meta <- read_excel("G:/.shortcut-targets-by-id/1IoJDOQWCFiL1qTzSja6byrAlCelNSTsT/Meta-analysis beliefs/Social Norms meta.xlsx", sheet = "ALL")
csv_path_output <- "C:/Users/stefa/Documents/CNR/GitHub/Social_norm_meta_analysis/Other/Report_202107/"
ls_game <- c("DG", "DG Tax", "UG", "PGG", "TG", "BG", "GEG", "PDG", "Donation Game", "Investment game", "ToG", "Tax Game")
#### Treatments stats ####
df_treat <- Social_Norms_meta %>%
subset.data.frame(subset = Target == "Y") %>%
subset.data.frame(subset = Game_type %in% ls_game) %>%
subset.data.frame(subset =
Environment %in% c("Classroom",
"Lab",
"Online",
"Lab-in-the-field",
"virtual Lab")) %>%
group_by(Game_type) %>%
summarise(
Treatments = n(),
Between_subjects_beliefs = sum(Separate_sample_beliefs == "Y", na.rm = T),
KW = sum(Method_elicitation == "KW", na.rm = T),
Bicchieri = sum(Method_elicitation == "Bicchieri", na.rm = T),
KW_Bicchieri = sum(Method_elicitation == "Both", na.rm = T),
Monetary_Punishment = sum(Punishment == "Monetary", na.rm = T),
Choice_Method_Direct = sum(Choice_Method == "Direct", na.rm = T),
Choice_Method_Strategy = sum(Choice_Method == "Strategy", na.rm = T),
OnlyNorms = sum(Choice_Method == "OnlyNorms", na.rm = T),
Choice_Method_Both = sum(Choice_Method == "Both", na.rm = T),
Available_Data = sum(StatusTreatment_Roma == "6-Complete", na.rm = T)
) %>%
arrange(-Treatments)
write.csv(df_treat, file = paste(csv_path_output, paste("Treatments.csv", sep = ""), sep = ""), row.names = F)
df_treat <- Social_Norms_meta %>%
subset.data.frame(subset = Target == "Y")
library(tidyverse)
library(readxl)
library(writexl)
rm(list = ls())
Social_Norms_meta <- read_excel("G:/.shortcut-targets-by-id/1IoJDOQWCFiL1qTzSja6byrAlCelNSTsT/Meta-analysis beliefs/Social Norms meta.xlsx", sheet = "ALL")
csv_path_output <- "C:/Users/stefa/Documents/CNR/GitHub/Social_norm_meta_analysis/Other/Report_202107/"
ls_game <- c("DG", "DG Tax", "UG", "PGG", "TG", "BG", "GEG", "PDG", "Donation Game", "Investment game", "ToG", "Tax Game")
df_treat <- Social_Norms_meta %>%
subset.data.frame(subset = Target == "Y")
View(df_treat)
suca=Social_Norms_meta %>% subset.data.frame(subset = Target == "Y")
length(levels(as.factor(suca$PaperID)))
levels(as.factor(suca$PaperID))
df_data <- Social_Norms_meta %>%
group_by(StatusTreatment_Roma) %>%
summarise(
N_Paper = n(),
)
View(df_data)
df_data <- Social_Norms_meta %>%
group_by(StatusTreatment_Roma) %>%
summarise(
N_Paper = n(),
) %>%
summarise(sum(N_Paper))
View(df_data)
View(df_data)
#### Data collection status ####
df_data <- Social_Norms_meta %>%
group_by(StatusTreatment_Roma) %>%
summarise(
N_Paper = n(),
)
View(df_data)
#### Data collection status ####
df_data <- Social_Norms_meta %>%
group_by(StatusTreatment_Roma) %>%
summarise(
N_Paper = n(),
) %>%
recode(StatusTreatment_Roma, "NA" = "Duplicates")
#### Data collection status ####
df_data <- Social_Norms_meta %>%
group_by(StatusTreatment_Roma) %>%
summarise(
N_Paper = n(),
) %>%
recode(StatusTreatment_Roma, NA = "Duplicates")
#### Data collection status ####
df_data <- Social_Norms_meta %>%
group_by(StatusTreatment_Roma) %>%
summarise(
N_Paper = n(),
)
df_data$Status <- recode(df_data$StatusTreatment_Roma, NA = "Duplicates")
df_data$Status <- recode(df_data$StatusTreatment_Roma, "NA" = "Duplicates")
View(df_data)
#### Data collection status ####
df_data <- Social_Norms_meta %>%
group_by(StatusTreatment_Roma) %>%
summarise(
N_Paper = n(),
) %>%
replace_na(StatusTreatment_Roma  = "Duplicates")
#### Data collection status ####
df_data <- Social_Norms_meta %>%
group_by(StatusTreatment_Roma) %>%
summarise(
N_Paper = n(),
) %>%
replace_na(list(StatusTreatment_Roma  = "Duplicates"))
View(df_data)
#### Data collection status ####
df_data <- Social_Norms_meta %>%
group_by(StatusTreatment_Roma) %>%
summarise(
N_Paper = n(),
) %>%
replace_na(list(StatusTreatment_Roma  = "Duplicates")) %>%
summarise(sum(N_Paper))
View(df_data)
View(df_data)
#### Data collection status ####
df_data <- Social_Norms_meta %>%
group_by(StatusTreatment_Roma) %>%
summarise(
N_Paper = n(),
) %>%
replace_na(list(StatusTreatment_Roma  = "Duplicates"))
View(df_data)
library(readr)
library(igraph)
library(tidyverse)
library(writexl)
library(visNetwork)
#remove environment objects
rm(list=ls())
#reading csv file
authors_net <- read_csv("ShinyApp/authors_net.csv")
#subset -> take rows with this condition only
authors_n <- authors_net[grep("--", authors_net$Authors), ]
# data wrangling from https://stackoverflow.com/questions/57487704/how-to-split-a-string-of-author-names-by-comma-into-a-data-frame-and-generate-an
SplitAuthors <- sapply(authors_n$Authors, strsplit, split = "--", fixed = TRUE)
AuthorCombinations <- sapply(SplitAuthors,function(x){combn(unlist(x),m = 2)})
AuthorEdges <- rapply(AuthorCombinations,unlist)
names(AuthorEdges) <- NULL
AuthorEdges <- trimws(AuthorEdges)
AuthorGraph <- graph(AuthorEdges, directed = FALSE)
#first plot: non interactive plot
plot(AuthorGraph,layout = layout_with_graphopt, edge.arrow.size = 0.2, vertex.cex = 0.7, mode = "circle")
#visNetwork package code
Nodes <- data.frame(id=as_ids(V(AuthorGraph)), label=as_ids(V(AuthorGraph)),
title = paste0("<p><b>", as_ids(V(AuthorGraph)),"</b><br></p>"))
Edges <- data.frame(matrix(AuthorEdges, ncol=2, byrow = T))
colnames(Edges) <- c("from", "to")
visNetwork(Nodes, Edges) %>%
visIgraphLayout(layout = "layout_with_fr")
#%>% visEdges(arrows = "middle")
#reading csv file
authors_net <- read_excel("G:/.shortcut-targets-by-id/1IoJDOQWCFiL1qTzSja6byrAlCelNSTsT/Meta-analysis beliefs/Social Norms meta.xlsx", sheet = "Network authors")
View(authors_net)
#reading csv file
authors_net <- read_excel("G:/.shortcut-targets-by-id/1IoJDOQWCFiL1qTzSja6byrAlCelNSTsT/Meta-analysis beliefs/Social Norms meta.xlsx", sheet = "ALL") %>%
subset.data.frame(subset = Target =="Y") %>%
distinct(PaperID)
View(authors_net)
#reading csv file
authors_net <- read_excel("G:/.shortcut-targets-by-id/1IoJDOQWCFiL1qTzSja6byrAlCelNSTsT/Meta-analysis beliefs/Social Norms meta.xlsx", sheet = "ALL") %>%
subset.data.frame(subset = Target =="Y") %>%
distinct(PaperID, .keep_all = T)
View(authors_net)
#reading csv file
authors_net <- read_excel("G:/.shortcut-targets-by-id/1IoJDOQWCFiL1qTzSja6byrAlCelNSTsT/Meta-analysis beliefs/Social Norms meta.xlsx", sheet = "ALL") %>%
subset.data.frame(subset = Target =="Y") %>%
distinct(PaperID, .keep_all = T) %>%
str_replace(Authors, ";", "--")
#reading csv file
authors_net <- read_excel("G:/.shortcut-targets-by-id/1IoJDOQWCFiL1qTzSja6byrAlCelNSTsT/Meta-analysis beliefs/Social Norms meta.xlsx", sheet = "ALL") %>%
subset.data.frame(subset = Target =="Y") %>%
distinct(PaperID, .keep_all = T) %>%
str_replace(";", "--")
#reading csv file
authors_net <- read_excel("G:/.shortcut-targets-by-id/1IoJDOQWCFiL1qTzSja6byrAlCelNSTsT/Meta-analysis beliefs/Social Norms meta.xlsx", sheet = "ALL") %>%
subset.data.frame(subset = Target =="Y") %>%
distinct(PaperID, .keep_all = T) %>%
str_replace(Authors, "[;]", "--")
#reading csv file
authors_net <- read_excel("G:/.shortcut-targets-by-id/1IoJDOQWCFiL1qTzSja6byrAlCelNSTsT/Meta-analysis beliefs/Social Norms meta.xlsx", sheet = "ALL") %>%
subset.data.frame(subset = Target =="Y") %>%
distinct(PaperID, .keep_all = T) %>%
str_replace(Authors, ";", "AA")
#reading csv file
authors_net <- read_excel("G:/.shortcut-targets-by-id/1IoJDOQWCFiL1qTzSja6byrAlCelNSTsT/Meta-analysis beliefs/Social Norms meta.xlsx", sheet = "ALL") %>%
subset.data.frame(subset = Target =="Y") %>%
distinct(PaperID, .keep_all = T)
#reading csv file
authors_net <- read_excel("G:/.shortcut-targets-by-id/1IoJDOQWCFiL1qTzSja6byrAlCelNSTsT/Meta-analysis beliefs/Social Norms meta.xlsx", sheet = "ALL") %>%
subset.data.frame(subset = Target =="Y") %>%
distinct(PaperID, .keep_all = T) %>%
str_replace_all(Authors, ";", "AA")
fruits <- c("one apple", "two pears", "three bananas")
str_replace(fruits, "[aeiou]", "-")
#reading csv file
authors_net <- read_excel("G:/.shortcut-targets-by-id/1IoJDOQWCFiL1qTzSja6byrAlCelNSTsT/Meta-analysis beliefs/Social Norms meta.xlsx", sheet = "ALL") %>%
subset.data.frame(subset = Target =="Y") %>%
distinct(PaperID, .keep_all = T)
View(authors_net)
str_replace(authors_net$Authors, ";", "--")
#reading csv file
authors_net <- read_excel("G:/.shortcut-targets-by-id/1IoJDOQWCFiL1qTzSja6byrAlCelNSTsT/Meta-analysis beliefs/Social Norms meta.xlsx", sheet = "ALL") %>%
subset.data.frame(subset = Target =="Y") %>%
distinct(PaperID, .keep_all = T) %>%
mutate(New_authors = str_replace_all(Authors, ";", "AA"))
View(authors_net)
#reading csv file
authors_net <- read_excel("G:/.shortcut-targets-by-id/1IoJDOQWCFiL1qTzSja6byrAlCelNSTsT/Meta-analysis beliefs/Social Norms meta.xlsx", sheet = "ALL") %>%
subset.data.frame(subset = Target =="Y") %>%
distinct(PaperID, .keep_all = T) %>%
mutate(New_authors = str_replace_all(Authors, ";", "--"))
# data wrangling from https://stackoverflow.com/questions/57487704/how-to-split-a-string-of-author-names-by-comma-into-a-data-frame-and-generate-an
SplitAuthors <- sapply(authors_net$New_authors, strsplit, split = "--", fixed = TRUE)
AuthorCombinations <- sapply(SplitAuthors,function(x){combn(unlist(x),m = 2)})
View(SplitAuthors)
View(SplitAuthors)
AuthorCombinations <- sapply(SplitAuthors,function(x){combn(unlist(x),m = 2)})
#subset -> take rows with this condition only
authors_n <- authors_net[grep("--", authors_net$New_Authors), ]
#subset -> take rows with this condition only
authors_n <- authors_net[grep("--", authors_net$New_authors), ]
# data wrangling from https://stackoverflow.com/questions/57487704/how-to-split-a-string-of-author-names-by-comma-into-a-data-frame-and-generate-an
SplitAuthors <- sapply(authors_n$New_authors, strsplit, split = "--", fixed = TRUE)
AuthorCombinations <- sapply(SplitAuthors,function(x){combn(unlist(x),m = 2)})
AuthorEdges <- rapply(AuthorCombinations,unlist)
names(AuthorEdges) <- NULL
AuthorEdges <- trimws(AuthorEdges)
AuthorGraph <- graph(AuthorEdges, directed = FALSE)
#first plot: non interactive plot
plot(AuthorGraph,layout = layout_with_graphopt, edge.arrow.size = 0.2, vertex.cex = 0.7, mode = "circle")
#visNetwork package code
Nodes <- data.frame(id=as_ids(V(AuthorGraph)), label=as_ids(V(AuthorGraph)),
title = paste0("<p><b>", as_ids(V(AuthorGraph)),"</b><br></p>"))
Edges <- data.frame(matrix(AuthorEdges, ncol=2, byrow = T))
colnames(Edges) <- c("from", "to")
visNetwork(Nodes, Edges) %>%
visIgraphLayout(layout = "layout_with_fr")
